<html ng-app="app">
<head>
    <link href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
    <link href="site.css" rel="stylesheet">

    <script src="bower_components/underscore/underscore.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/cryptojslib/rollups/aes.js"></script>

    <script src="encryptionService.js"></script>
    <script src="errorService.js"></script>
    <script src="errorCtrl.js"></script>
    <script src="recordService.js"></script>
    <script src="recordsCtrl.js"></script>
    <script src="mainCtrl.js"></script>
    <script src="app.js"></script>
</head>

<!-- TODO: remove mainCtrl - use ui-router and a controller per state -->
<body class="container" ng-controller="mainCtrl">
    <div class="row">
        <div class="banner bg-success col-sm-12">
            <span class="h1">Dayary</span> - day by day
            <button class="btn btn-success pull-right" ng-click="settingsEdit = true">
                Settings
            </button>
        </div>
    </div>

    <div class="row">
        <div ng-controller="errorCtrl" class="col-sm-12">
            <div class="bg-danger" ng-show="error">
                Error: {{error}}
                <button type="button" class="close" ng-click="unsetError()">
                    <span>&times;</span>
                </button>
            </div>
        </div>

        <!-- TODO: move this to the viewer section -->
        <div ng-show="!selected" class="bg-success col-sm-12">
            Looks like this is a fresh new diary. Start by hitting 'Add' to
            add a new record.
        </div>

        <div ng-include="'records.html'" ng-controller="recordsCtrl">
        </div>

        <div ng-show="selected"
             ng-class="{ 'col-sm-9' : !settingsEdit, 'col-sm-6': settingsEdit }">
            <h2>{{selected.created | date : 'fullDate'}}</h2>

            <div ng-hide="editing">
                <button class="btn btn-success"
                        ng-click="startEdit(selected)">
                    Edit
                </button>

                <span class="bg-success">
                    - last updated on
                    {{selected.updated | date : 'EEEE, MMMM d, y HH:mm:ss'}}
                </span>
            </div>

            <div ng-show="editing">
                <button class="btn btn-success"
                        ng-click="view(selected)">
                    View
                </button>

                <span class="bg-success"
                      ng-show="saved">
                    - {{saved}}
                </span>
            </div>

            <br />

            <!-- TODO: show ajax-loader while loading -->
            <!-- Use ng-bind to ensure no spare spaces of white lines -->
            <p class="text-viewer"
               ng-hide="editing"
               ng-bind="selected.text">
           </p>

            <textarea ng-show="editing"
                      ng-model="selected.text" ng-trim="false"
                      rows=15 class="text-editor"
                      placeholder="Enter text here...">
            </textarea>
        </div>

        <div ng-show="settingsEdit" class="col-sm-3">
            <h2>Settings</h2>
            <div>
                <button class="btn btn-success" ng-click="saveSettings()">
                    Done
                </button>
            </div>

            <br />

            <div>Pass Phrase:</div>
            <input type="text" ng-model="passphrase" ng-trim="false">

            <br />
            <br />

            <div>Auto Save (sec):</div>
            <input type="number" ng-model="autosaveInterval">
        </div>
    </div>
<body>
</html>
